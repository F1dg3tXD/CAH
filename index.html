<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cards Against Hellborns</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Poppins:wght@400;600;700&display=swap');
        
        :root {
            --primary: #8b0000;
            --secondary: #ff4500;
            --dark: #1a1a1a;
            --light: #f8f8f8;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            min-height: 100vh;
        }
        
        .title-font {
            font-family: 'Creepster', cursive;
        }
        
        .card {
            background: linear-gradient(145deg, #2a2a2a, #1e1e1e);
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 1px solid var(--primary);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(139, 0, 0, 0.4);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--dark);
            color: var(--light);
            border: 1px solid var(--primary);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: var(--primary);
            transform: translateY(-2px);
        }
        
        .player-card {
            background: rgba(43, 43, 43, 0.7);
            border-left: 4px solid var(--primary);
        }
        
        .lobby-card {
            background: rgba(43, 43, 43, 0.7);
            border-bottom: 4px solid var(--primary);
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 69, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 69, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 69, 0, 0); }
        }
        
        .glow {
            text-shadow: 0 0 10px var(--secondary), 0 0 20px var(--secondary);
        }
        
        .skull-icon {
            filter: drop-shadow(0 0 5px var(--secondary));
        }
        
        .card-selected {
            transform: translateY(-20px);
            box-shadow: 0 0 20px var(--secondary);
            border: 2px solid var(--secondary);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .typewriter h1 {
            overflow: hidden;
            border-right: .15em solid var(--secondary);
            white-space: nowrap;
            margin: 0 auto;
            letter-spacing: .15em;
            animation: 
                typing 3.5s steps(40, end),
                blink-caret .75s step-end infinite;
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--secondary); }
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Main App Container -->
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- Username Modal -->
        <div id="usernameModal" class="modal-overlay">
            <div class="bg-gray-900 rounded-xl p-8 max-w-md w-full mx-4 card">
                <div class="text-center mb-6">
                    <i class="fas fa-skull skull-icon text-5xl mb-4 text-red-600"></i>
                    <h1 class="title-font text-4xl mb-2 text-red-500 glow">Cards Against Hellborns</h1>
                    <p class="text-gray-300">Enter your demonic alias to begin</p>
                </div>
                <div class="mb-6">
                    <input type="text" id="usernameInput" placeholder="Your Hellish Name" class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-red-900 focus:outline-none focus:ring-2 focus:ring-red-600 text-white">
                </div>
                <button id="submitUsername" class="btn-primary w-full py-3 rounded-lg font-bold uppercase tracking-wider">
                    Enter the Underworld <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
        
        <!-- Main Menu (Hidden Initially) -->
        <div id="mainMenu" class="hidden">
            <div class="text-center mb-12">
                <h1 class="title-font text-5xl md:text-6xl mb-4 text-red-500 glow">
                    <span class="typewriter">Cards Against Hellborns</span>
                </h1>
                <p class="text-gray-400 max-w-2xl mx-auto">A diabolical twist on the classic card game where only the most wicked answers prevail!</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <!-- Create Lobby Card -->
                <div class="card p-6 flex flex-col items-center text-center hover:cursor-pointer" id="createLobbyBtn">
                    <div class="bg-red-900 rounded-full p-4 mb-4 floating">
                        <i class="fas fa-plus text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Create Lobby</h3>
                    <p class="text-gray-400 mb-4">Summon a new game from the depths of hell</p>
                    <button class="btn-primary px-6 py-2 rounded-full text-sm">Conjure</button>
                </div>
                
                <!-- Join Lobby Card -->
                <div class="card p-6 flex flex-col items-center text-center hover:cursor-pointer" id="joinLobbyBtn">
                    <div class="bg-red-900 rounded-full p-4 mb-4 floating" style="animation-delay: 0.2s">
                        <i class="fas fa-users text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Join Lobby</h3>
                    <p class="text-gray-400 mb-4">Enter an existing den of iniquity</p>
                    <button class="btn-primary px-6 py-2 rounded-full text-sm">Descend</button>
                </div>
                
                <!-- How to Play Card -->
                <div class="card p-6 flex flex-col items-center text-center">
                    <div class="bg-red-900 rounded-full p-4 mb-4 floating" style="animation-delay: 0.4s">
                        <i class="fas fa-question text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">How to Play</h3>
                    <p class="text-gray-400 mb-4">Learn the ways of the damned</p>
                    <button class="btn-secondary px-6 py-2 rounded-full text-sm">Instruct</button>
                </div>
            </div>
            
            <!-- Current User Display -->
            <div class="flex justify-center">
                <div class="bg-gray-800 rounded-full px-6 py-2 flex items-center">
                    <i class="fas fa-user-secret text-red-500 mr-2"></i>
                    <span id="currentUsernameDisplay" class="font-medium">Player</span>
                    <button id="changeUsernameBtn" class="ml-4 text-gray-400 hover:text-red-500">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Create Lobby Modal -->
        <div id="createLobbyModal" class="modal-overlay hidden">
            <div class="bg-gray-900 rounded-xl p-8 max-w-md w-full mx-4 card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-red-500">Create Lobby</h2>
                    <button id="closeCreateLobby" class="text-gray-400 hover:text-red-500">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2">Lobby Name</label>
                    <input type="text" id="lobbyNameInput" placeholder="Infernal Chamber" class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-red-900 focus:outline-none focus:ring-2 focus:ring-red-600 text-white">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2">Max Players (2-8)</label>
                    <input type="number" id="maxPlayersInput" min="2" max="8" value="4" class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-red-900 focus:outline-none focus:ring-2 focus:ring-red-600 text-white">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2">Rounds</label>
                    <input type="number" id="roundsInput" min="3" max="15" value="5" class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-red-900 focus:outline-none focus:ring-2 focus:ring-red-600 text-white">
                </div>
                <button id="confirmCreateLobby" class="btn-primary w-full py-3 rounded-lg font-bold uppercase tracking-wider">
                    Summon Lobby <i class="fas fa-fire ml-2"></i>
                </button>
            </div>
        </div>
        
        <!-- Join Lobby Modal -->
        <div id="joinLobbyModal" class="modal-overlay hidden">
            <div class="bg-gray-900 rounded-xl p-8 max-w-2xl w-full mx-4 card">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-red-500">Join Lobby</h2>
                    <button id="closeJoinLobby" class="text-gray-400 hover:text-red-500">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="mb-4 flex">
                    <input type="text" id="lobbySearchInput" placeholder="Search for a lobby..." class="flex-grow px-4 py-3 rounded-l-lg bg-gray-800 border border-red-900 focus:outline-none focus:ring-2 focus:ring-red-600 text-white">
                    <button id="searchLobbyBtn" class="btn-primary px-4 rounded-r-lg">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="overflow-y-auto max-h-96">
                    <div id="lobbyList" class="space-y-3">
                        <!-- Lobby items will be added here dynamically -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Lobby Screen -->
        <div id="lobbyScreen" class="hidden">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h2 class="title-font text-3xl text-red-500" id="lobbyNameDisplay">Lobby Name</h2>
                    <p class="text-gray-400" id="lobbyCodeDisplay">Code: HELL-1234</p>
                </div>
                <button id="leaveLobbyBtn" class="btn-secondary px-6 py-2 rounded-lg flex items-center">
                    <i class="fas fa-door-open mr-2"></i> Leave Lobby
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="md:col-span-3">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-users text-red-500 mr-2"></i> Players
                            <span class="ml-auto text-gray-400" id="playersCount">1/4</span>
                        </h3>
                        
                        <div id="playersList" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <!-- Player cards will be added here dynamically -->
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="card p-6 mb-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-cog text-red-500 mr-2"></i> Settings
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-300 text-sm mb-1">Rounds</label>
                                <p class="font-medium" id="lobbyRoundsDisplay">5</p>
                            </div>
                            
                            <div>
                                <label class="block text-gray-300 text-sm mb-1">Status</label>
                                <p class="font-medium" id="lobbyStatusDisplay">Waiting for players</p>
                            </div>
                        </div>
                    </div>
                    
                    <button id="startGameBtn" class="btn-primary w-full py-3 rounded-lg font-bold uppercase tracking-wider hidden">
                        Begin Damnation <i class="fas fa-play ml-2"></i>
                    </button>
                </div>
            </div>
            
            <div class="card p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-comment-dots text-red-500 mr-2"></i> Chat
                </h3>
                
                <div id="chatMessages" class="h-40 overflow-y-auto mb-4 space-y-2">
                    <!-- Chat messages will appear here -->
                </div>
                
                <div class="flex">
                    <input type="text" id="chatInput" placeholder="Type your message..." class="flex-grow px-4 py-2 rounded-l-lg bg-gray-800 border border-red-900 focus:outline-none focus:ring-2 focus:ring-red-600 text-white">
                    <button id="sendChatBtn" class="btn-primary px-4 py-2 rounded-r-lg">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="title-font text-3xl text-red-500" id="gameLobbyNameDisplay">Lobby Name</h2>
                    <div class="flex items-center space-x-4 text-sm">
                        <span class="text-gray-400" id="gameRoundDisplay">Round 1/5</span>
                        <span class="text-gray-400" id="gameCzarDisplay">Card Czar: Player1</span>
                    </div>
                </div>
                <button id="leaveGameBtn" class="btn-secondary px-6 py-2 rounded-lg flex items-center">
                    <i class="fas fa-door-open mr-2"></i> Leave Game
                </button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Players List Column -->
                <div class="lg:col-span-1 order-2 lg:order-1">
                    <div class="card p-6">
                        <h3 class="text-xl font-bold mb-4 flex items-center">
                            <i class="fas fa-users text-red-500 mr-2"></i> Players
                        </h3>
                        
                        <div id="gamePlayersList" class="space-y-3">
                            <!-- Player status in game will appear here -->
                        </div>
                    </div>
                </div>
                
                <!-- Main Game Area -->
                <div class="lg:col-span-2 order-1 lg:order-2">
                    <!-- Black Card Display -->
                    <div class="card p-6 mb-6 bg-black text-white border-2 border-red-900">
                        <div class="flex justify-between items-start mb-4">
                            <div class="bg-red-900 text-xs px-2 py-1 rounded">BLACK CARD</div>
                            <div class="text-gray-400 text-sm" id="blackCardPickDisplay">Pick 1</div>
                        </div>
                        <p class="text-xl font-medium" id="blackCardTextDisplay">Why did the chicken cross the road? _____.</p>
                    </div>
                    
                    <!-- Selected Cards Display (for Czar) -->
                    <div id="czarSelectionArea" class="hidden mb-6">
                        <h3 class="text-lg font-bold mb-3 flex items-center">
                            <i class="fas fa-chess-king text-red-500 mr-2"></i> Choose the winning answer
                        </h3>
                        <div id="submittedCardsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Submitted cards will appear here for Czar to pick -->
                        </div>
                    </div>
                    
                    <!-- Player's Hand -->
                    <div id="playerHandArea">
                        <h3 class="text-lg font-bold mb-3 flex items-center">
                            <i class="fas fa-hand-paper text-red-500 mr-2"></i> Your Hand
                            <span class="ml-auto text-sm text-gray-400" id="cardsRemainingDisplay">5 cards remaining</span>
                        </h3>
                        
                        <div id="playerHand" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Player's white cards will appear here -->
                        </div>
                        
                        <div class="mt-4 text-center hidden" id="waitingForCzarMessage">
                            <div class="p-4 bg-gray-800 rounded-lg inline-block">
                                <i class="fas fa-hourglass-half text-red-500 mr-2"></i>
                                <span>Waiting for the Card Czar to choose...</span>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-center hidden" id="selectCardsMessage">
                            <button id="submitCardsBtn" class="btn-primary px-6 py-3 rounded-lg font-bold">
                                Submit Selection <i class="fas fa-paper-plane ml-2"></i>
                            </button>
                            <p class="text-sm text-gray-400 mt-2" id="cardsToSelectDisplay">Select 1 more card</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Game Chat -->
            <div class="card p-6 mt-6">
                <h3 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-comment-dots text-red-500 mr-2"></i> Game Chat
                </h3>
                
                <div id="gameChatMessages" class="h-32 overflow-y-auto mb-4 space-y-2">
                    <!-- Game chat messages will appear here -->
                </div>
                
                <div class="flex">
                    <input type="text" id="gameChatInput" placeholder="Type your message..." class="flex-grow px-4 py-2 rounded-l-lg bg-gray-800 border border-red-900 focus:outline-none focus:ring-2 focus:ring-red-600 text-white">
                    <button id="sendGameChatBtn" class="btn-primary px-4 py-2 rounded-r-lg">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Game Over Modal -->
        <div id="gameOverModal" class="modal-overlay hidden">
            <div class="bg-gray-900 rounded-xl p-8 max-w-2xl w-full mx-4 card">
                <div class="text-center mb-6">
                    <i class="fas fa-trophy text-5xl mb-4 text-red-500"></i>
                    <h2 class="title-font text-4xl mb-2 text-red-500">Game Over!</h2>
                    <p class="text-gray-300">The forces of hell have spoken</p>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-center">Final Scores</h3>
                    <div id="finalScores" class="space-y-3 max-w-md mx-auto">
                        <!-- Final scores will appear here -->
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button id="newGameBtn" class="btn-primary flex-1 py-3 rounded-lg font-bold">
                        New Game <i class="fas fa-plus ml-2"></i>
                    </button>
                    <button id="returnToLobbyBtn" class="btn-secondary flex-1 py-3 rounded-lg font-bold">
                        Return to Lobby <i class="fas fa-users ml-2"></i>
                    </button>
                    <button id="mainMenuBtn" class="btn-secondary flex-1 py-3 rounded-lg font-bold">
                        Main Menu <i class="fas fa-home ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            username: '',
            currentScreen: 'mainMenu',
            lobby: null,
            game: null,
            isHost: false,
            selectedCards: [],
            submittedCards: [],
            whiteCards: [],
            blackCards: []
        };
        
        // DOM Elements
        const elements = {
            usernameModal: document.getElementById('usernameModal'),
            usernameInput: document.getElementById('usernameInput'),
            submitUsername: document.getElementById('submitUsername'),
            mainMenu: document.getElementById('mainMenu'),
            currentUsernameDisplay: document.getElementById('currentUsernameDisplay'),
            changeUsernameBtn: document.getElementById('changeUsernameBtn'),
            
            // Lobby Creation
            createLobbyBtn: document.getElementById('createLobbyBtn'),
            createLobbyModal: document.getElementById('createLobbyModal'),
            lobbyNameInput: document.getElementById('lobbyNameInput'),
            maxPlayersInput: document.getElementById('maxPlayersInput'),
            roundsInput: document.getElementById('roundsInput'),
            confirmCreateLobby: document.getElementById('confirmCreateLobby'),
            closeCreateLobby: document.getElementById('closeCreateLobby'),
            
            // Lobby Joining
            joinLobbyBtn: document.getElementById('joinLobbyBtn'),
            joinLobbyModal: document.getElementById('joinLobbyModal'),
            lobbySearchInput: document.getElementById('lobbySearchInput'),
            searchLobbyBtn: document.getElementById('searchLobbyBtn'),
            lobbyList: document.getElementById('lobbyList'),
            noLobbiesMessage: document.getElementById('noLobbiesMessage'),
            closeJoinLobby: document.getElementById('closeJoinLobby'),
            
            // Lobby Screen
            lobbyScreen: document.getElementById('lobbyScreen'),
            lobbyNameDisplay: document.getElementById('lobbyNameDisplay'),
            lobbyCodeDisplay: document.getElementById('lobbyCodeDisplay'),
            playersCount: document.getElementById('playersCount'),
            playersList: document.getElementById('playersList'),
            lobbyRoundsDisplay: document.getElementById('lobbyRoundsDisplay'),
            lobbyStatusDisplay: document.getElementById('lobbyStatusDisplay'),
            startGameBtn: document.getElementById('startGameBtn'),
            leaveLobbyBtn: document.getElementById('leaveLobbyBtn'),
            chatMessages: document.getElementById('chatMessages'),
            chatInput: document.getElementById('chatInput'),
            sendChatBtn: document.getElementById('sendChatBtn'),
            
            // Game Screen
            gameScreen: document.getElementById('gameScreen'),
            gameLobbyNameDisplay: document.getElementById('gameLobbyNameDisplay'),
            gameRoundDisplay: document.getElementById('gameRoundDisplay'),
            gameCzarDisplay: document.getElementById('gameCzarDisplay'),
            leaveGameBtn: document.getElementById('leaveGameBtn'),
            gamePlayersList: document.getElementById('gamePlayersList'),
            blackCardTextDisplay: document.getElementById('blackCardTextDisplay'),
            blackCardPickDisplay: document.getElementById('blackCardPickDisplay'),
            czarSelectionArea: document.getElementById('czarSelectionArea'),
            submittedCardsContainer: document.getElementById('submittedCardsContainer'),
            playerHandArea: document.getElementById('playerHandArea'),
            playerHand: document.getElementById('playerHand'),
            waitingForCzarMessage: document.getElementById('waitingForCzarMessage'),
            selectCardsMessage: document.getElementById('selectCardsMessage'),
            submitCardsBtn: document.getElementById('submitCardsBtn'),
            cardsToSelectDisplay: document.getElementById('cardsToSelectDisplay'),
            cardsRemainingDisplay: document.getElementById('cardsRemainingDisplay'),
            gameChatMessages: document.getElementById('gameChatMessages'),
            gameChatInput: document.getElementById('gameChatInput'),
            sendGameChatBtn: document.getElementById('sendGameChatBtn'),
            
            // Game Over
            gameOverModal: document.getElementById('gameOverModal'),
            finalScores: document.getElementById('finalScores'),
            newGameBtn: document.getElementById('newGameBtn'),
            returnToLobbyBtn: document.getElementById('returnToLobbyBtn'),
            mainMenuBtn: document.getElementById('mainMenuBtn')
        };
        
        // Event Listeners
        elements.submitUsername.addEventListener('click', setUsername);
        elements.usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') setUsername();
        });
        
        elements.changeUsernameBtn.addEventListener('click', () => {
            elements.usernameModal.classList.remove('hidden');
            elements.mainMenu.classList.add('hidden');
        });
        
        // Lobby Creation
        elements.createLobbyBtn.addEventListener('click', () => {
            elements.createLobbyModal.classList.remove('hidden');
        });
        
        elements.closeCreateLobby.addEventListener('click', () => {
            elements.createLobbyModal.classList.add('hidden');
        });
        
        elements.confirmCreateLobby.addEventListener('click', createLobby);
        
        // Lobby Joining
        elements.joinLobbyBtn.addEventListener('click', () => {
            elements.joinLobbyModal.classList.remove('hidden');
            loadLobbies();
        });
        
        elements.closeJoinLobby.addEventListener('click', () => {
            elements.joinLobbyModal.classList.add('hidden');
        });
        
        elements.searchLobbyBtn.addEventListener('click', loadLobbies);
        elements.lobbySearchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') loadLobbies();
        });
        
        // Lobby Screen
        elements.leaveLobbyBtn.addEventListener('click', leaveLobby);
        elements.startGameBtn.addEventListener('click', startGame);
        elements.sendChatBtn.addEventListener('click', sendLobbyChat);
        elements.chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendLobbyChat();
        });
        
        // Game Screen
        elements.leaveGameBtn.addEventListener('click', leaveGame);
        elements.submitCardsBtn.addEventListener('click', submitCards);
        elements.sendGameChatBtn.addEventListener('click', sendGameChat);
        elements.gameChatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendGameChat();
        });
        
        // Game Over
        elements.newGameBtn.addEventListener('click', newGame);
        elements.returnToLobbyBtn.addEventListener('click', returnToLobby);
        elements.mainMenuBtn.addEventListener('click', returnToMainMenu);
        
        // Initialize game
        // initGame(); // REMOVE THIS LINE

        document.addEventListener('DOMContentLoaded', () => {
            initGame();
        });

        async function initGame() {
            try {
                // Load card data from JSON files
                const [whiteCardsResponse, blackCardsResponse] = await Promise.all([
                    fetch('answers.json'),
                    fetch('prompts.json')
                ]);
                
                if (!whiteCardsResponse.ok || !blackCardsResponse.ok) {
                    throw new Error('Failed to load card data');
                }
                
                gameState.whiteCards = await whiteCardsResponse.json();
                gameState.blackCards = await blackCardsResponse.json();
                
                // Show username modal
                showScreen('usernameModal');
            } catch (error) {
                console.error('Error loading card data:', error);
                alert('Failed to load card data. Please check if answers.json and prompts.json files exist.');
                
                // Use fallback data if files can't be loaded
                gameState.whiteCards = [
                    "Getting really high and watching Planet Earth.",
                    "The total collapse of the global financial system.",
                    "A micropig wearing a tiny raincoat and booties.",
                    "A madman who lives in a police box and kidnaps women.",
                    "A bitch slap.",
                    "The primal, ball-slapping sex your parents are having right now.",
                    "A cat with... hands.",
                    "A lamprey swimming up the toilet and latching onto your taint.",
                    "A mopey zoo lion.",
                    "A PowerPoint presentation.",
                    "A time travel paradox.",
                    "The moist, demanding chasm of his mouth.",
                    "Filling every orifice with butterscotch pudding.",
                    "Unlimited soup, salad, and breadsticks.",
                    "Crying into the pages of Sylvia Plath.",
                    "Velcro™.",
                    "The violation of our most basic human rights.",
                    "A disappointing birthday party.",
                    "Picking up a glass of water and taking a sip and being the president.",
                    "A man on the brink of orgasm when he realizes he's about to ejaculate into a diaper."
                ];
                
                gameState.blackCards = [
                    { text: "Why did the chicken cross the road? _____.", pick: 1 },
                    { text: "What's the next superhero movie? _____: Origins.", pick: 1 },
                    { text: "What's the secret to a happy marriage? _____ and _____.", pick: 2 },
                    { text: "What ended my last relationship? _____.", pick: 1 },
                    { text: "What's the next holiday special? _____: The Movie.", pick: 1 },
                    { text: "What's the best way to get over a breakup? _____ and _____.", pick: 2 },
                    { text: "What's the secret to great sex? _____ and _____.", pick: 2 },
                    { text: "What's my secret power? _____.", pick: 1 }
                ];
                
                showScreen('usernameModal');
            }
        }
        
        function setUsername() {
            const username = elements.usernameInput.value.trim();
            if (username.length < 3 || username.length > 20) {
                alert('Username must be between 3 and 20 characters');
                return;
            }
            
            gameState.username = username;
            elements.currentUsernameDisplay.textContent = username;
            elements.usernameModal.classList.add('hidden');
            elements.mainMenu.classList.remove('hidden');
            
            // Add welcome message
            addChatMessage('System', `${username} has entered the underworld!`, true);
        }
        
        function createLobby() {
            const lobbyName = elements.lobbyNameInput.value.trim();
            const maxPlayers = parseInt(elements.maxPlayersInput.value);
            const rounds = parseInt(elements.roundsInput.value);
            
            if (lobbyName.length < 3 || lobbyName.length > 30) {
                alert('Lobby name must be between 3 and 30 characters');
                return;
            }
            
            if (isNaN(maxPlayers) || maxPlayers < 2 || maxPlayers > 8) {
                alert('Max players must be between 2 and 8');
                return;
            }
            
            if (isNaN(rounds) || rounds < 3 || rounds > 15) {
                alert('Rounds must be between 3 and 15');
                return;
            }
            
            // Generate a random lobby code
            const adjectives = ['Burning', 'Fiery', 'Infernal', 'Demonic', 'Hellish', 'Abyssal', 'Satanic', 'Diabolical'];
            const nouns = ['Pit', 'Chamber', 'Circle', 'Realm', 'Domain', 'Inferno', 'Abyss', 'Underworld'];
            const randomNum = Math.floor(Math.random() * 9000) + 1000;
            
            const lobbyCode = `${adjectives[Math.floor(Math.random() * adjectives.length)]}-${nouns[Math.floor(Math.random() * nouns.length)]}-${randomNum}`;
            
            // Create lobby object
            gameState.lobby = {
                id: `lobby-${Date.now()}`,
                name: lobbyName,
                code: lobbyCode,
                maxPlayers: maxPlayers,
                rounds: rounds,
                players: [
                    {
                        id: `player-${Date.now()}`,
                        name: gameState.username,
                        isHost: true,
                        points: 0
                    }
                ],
                chat: []
            };
            
            gameState.isHost = true;
            
            // Update UI
            elements.createLobbyModal.classList.add('hidden');
            updateLobbyScreen();
            
            // Show lobby screen
            showScreen('lobbyScreen');
            
            // Add system message
            addChatMessage('System', `${gameState.username} has created the lobby "${lobbyName}"`, true);
        }
        
        function loadLobbies() {
            const searchTerm = elements.lobbySearchInput.value.toLowerCase();
            
            // Clear current lobby list
            elements.lobbyList.innerHTML = '';
            
            // In a real app, this would fetch lobbies from the server
            // For demo purposes, we'll create some sample lobbies
            const sampleLobbies = [
                { 
                    id: 'lobby1', 
                    name: 'Infernal Chamber', 
                    players: 2, 
                    maxPlayers: 4, 
                    rounds: 5 
                },
                { 
                    id: 'lobby2', 
                    name: 'Abyssal Pit', 
                    players: 1, 
                    maxPlayers: 6, 
                    rounds: 7 
                },
                { 
                    id: 'lobby3', 
                    name: 'Demonic Ritual', 
                    players: 3, 
                    maxPlayers: 5, 
                    rounds: 10 
                }
            ];
            
            // Filter lobbies based on search term
            const filteredLobbies = sampleLobbies.filter(lobby => 
                lobby.name.toLowerCase().includes(searchTerm)
            );
            
            if (filteredLobbies.length === 0) {
                elements.noLobbiesMessage.classList.remove('hidden');
                return;
            }
            
            elements.noLobbiesMessage.classList.add('hidden');
            
            // Add lobbies to the list
            filteredLobbies.forEach(lobby => {
                const lobbyElement = document.createElement('div');
                lobbyElement.className = 'lobby-card p-4 rounded-lg flex justify-between items-center';
                lobbyElement.innerHTML = `
                    <div>
                        <h3 class="font-bold">${lobby.name}</h3>
                        <p class="text-sm text-gray-400">${lobby.players}/${lobby.maxPlayers} players • ${lobby.rounds} rounds</p>
                    </div>
                    <button class="btn-primary px-4 py-2 rounded-lg text-sm join-lobby-btn" data-lobby-id="${lobby.id}">
                        Join <i class="fas fa-arrow-right ml-1"></i>
                    </button>
                `;
                
                elements.lobbyList.appendChild(lobbyElement);
            });
            
            // Add event listeners to join buttons
            document.querySelectorAll('.join-lobby-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const lobbyId = e.target.getAttribute('data-lobby-id');
                    joinLobby(lobbyId);
                });
            });
        }
        
        function joinLobby(lobbyId) {
            // In a real app, this would fetch the lobby data from the server
            // For demo purposes, we'll use sample data
            const sampleLobbies = [
                { 
                    id: 'lobby1', 
                    name: 'Infernal Chamber', 
                    players: 2, 
                    maxPlayers: 4, 
                    rounds: 5 
                },
                { 
                    id: 'lobby2', 
                    name: 'Abyssal Pit', 
                    players: 1, 
                    maxPlayers: 6, 
                    rounds: 7 
                },
                { 
                    id: 'lobby3', 
                    name: 'Demonic Ritual', 
                    players: 3, 
                    maxPlayers: 5, 
                    rounds: 10 
                }
            ];
            
            const lobby = sampleLobbies.find(l => l.id === lobbyId);
            
            if (!lobby) {
                alert('Lobby not found');
                return;
            }
            
            // Create lobby object
            gameState.lobby = {
                id: lobby.id,
                name: lobby.name,
                code: `DEMO-${lobby.id.toUpperCase()}`,
                maxPlayers: lobby.maxPlayers,
                rounds: lobby.rounds,
                players: [
                    {
                        id: 'player1',
                        name: 'Player1',
                        isHost: true,
                        points: 0
                    },
                    {
                        id: 'player2',
                        name: 'Player2',
                        isHost: false,
                        points: 0
                    },
                    {
                        id: `player-${Date.now()}`,
                        name: gameState.username,
                        isHost: false,
                        points: 0
                    }
                ],
                chat: []
            };
            
            gameState.isHost = false;
            
            // Update UI
            elements.joinLobbyModal.classList.add('hidden');
            updateLobbyScreen();
            
            // Show lobby screen
            showScreen('lobbyScreen');
            
            // Add system message
            addChatMessage('System', `${gameState.username} has joined the lobby`, true);
        }
        
        function updateLobbyScreen() {
            if (!gameState.lobby) return;
            
            elements.lobbyNameDisplay.textContent = gameState.lobby.name;
            elements.lobbyCodeDisplay.textContent = `Code: ${gameState.lobby.code}`;
            elements.playersCount.textContent = `${gameState.lobby.players.length}/${gameState.lobby.maxPlayers}`;
            elements.lobbyRoundsDisplay.textContent = gameState.lobby.rounds;
            
            // Update players list
            elements.playersList.innerHTML = '';
            
            gameState.lobby.players.forEach(player => {
                const playerElement = document.createElement('div');
                playerElement.className = 'player-card p-4 rounded-lg flex items-center';
                playerElement.innerHTML = `
                    <div class="w-10 h-10 rounded-full ${player.isHost ? 'bg-red-900' : 'bg-gray-700'} flex items-center justify-center mr-3">
                        <i class="fas ${player.isHost ? 'fa-crown' : 'fa-user'}"></i>
                    </div>
                    <div>
                        <h4 class="font-medium">${player.name}</h4>
                        <p class="text-xs text-gray-400">${player.isHost ? 'Host' : 'Player'} • ${player.points} pts</p>
                    </div>
                `;
                
                elements.playersList.appendChild(playerElement);
            });
            
            // Show start game button only for host
            if (gameState.isHost) {
                elements.startGameBtn.classList.remove('hidden');
            } else {
                elements.startGameBtn.classList.add('hidden');
            }
            
            // Update lobby status
            if (gameState.lobby.players.length >= gameState.lobby.maxPlayers) {
                elements.lobbyStatusDisplay.textContent = 'Lobby full';
            } else {
                elements.lobbyStatusDisplay.textContent = 'Waiting for players';
            }
        }
        
        function leaveLobby() {
            if (confirm('Are you sure you want to leave the lobby?')) {
                // In a real app, this would notify the server
                
                // Add system message
                addChatMessage('System', `${gameState.username} has left the lobby`, true);
                
                // Reset lobby state
                gameState.lobby = null;
                gameState.isHost = false;
                
                // Return to main menu
                showScreen('mainMenu');
            }
        }
        
        function startGame() {
            if (!gameState.lobby || !gameState.isHost) return;
            
            // Create game object
            gameState.game = {
                lobbyId: gameState.lobby.id,
                round: 1,
                totalRounds: gameState.lobby.rounds,
                players: [...gameState.lobby.players],
                currentCzarIndex: 0,
                blackCard: getRandomBlackCard(),
                submittedCards: [],
                chat: []
            };
            
            // Deal white cards to each player (except Czar)
            gameState.game.players.forEach((player, index) => {
                player.hand = [];
                if (index !== gameState.game.currentCzarIndex) {
                    for (let i = 0; i < 7; i++) {
                        player.hand.push(getRandomWhiteCard());
                    }
                }
            });
            
            // Update UI and show game screen
            updateGameScreen();
            showScreen('gameScreen');
            
            // Add system message
            addGameChatMessage('System', 'The game has begun! The Card Czar will choose the winning answer.', true);
        }
        
        function updateGameScreen() {
            if (!gameState.game) return;
            
            elements.gameLobbyNameDisplay.textContent = gameState.lobby.name;
            elements.gameRoundDisplay.textContent = `Round ${gameState.game.round}/${gameState.game.totalRounds}`;
            
            // Update current Czar display
            const currentCzar = gameState.game.players[gameState.game.currentCzarIndex];
            elements.gameCzarDisplay.textContent = `Card Czar: ${currentCzar.name}`;
            
            // Update black card display
            elements.blackCardTextDisplay.textContent = gameState.game.blackCard.text;
            elements.blackCardPickDisplay.textContent = `Pick ${gameState.game.blackCard.pick}`;
            
            // Update players list
            elements.gamePlayersList.innerHTML = '';
            
            gameState.game.players.forEach((player, index) => {
                const isCzar = index === gameState.game.currentCzarIndex;
                const hasSubmitted = gameState.game.submittedCards.some(card => card.playerId === player.id);
                
                const playerElement = document.createElement('div');
                playerElement.className = 'player-card p-3 rounded-lg flex items-center justify-between';
                playerElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full ${isCzar ? 'bg-red-900' : 'bg-gray-700'} flex items-center justify-center mr-3">
                            <i class="fas ${isCzar ? 'fa-crown' : 'fa-user'} text-xs"></i>
                        </div>
                        <div>
                            <h4 class="font-medium">${player.name}</h4>
                            <p class="text-xs text-gray-400">${player.points} pts</p>
                        </div>
                    </div>
                    <div class="text-xs ${isCzar ? 'bg-red-900' : hasSubmitted ? 'bg-gray-700' : 'bg-gray-800'} px-2 py-1 rounded-full">
                        ${isCzar ? 'Czar' : hasSubmitted ? 'Submitted' : 'Choosing...'}
                    </div>
                `;
                
                elements.gamePlayersList.appendChild(playerElement);
            });
            
            // Update player's hand (if not Czar)
            const currentPlayer = gameState.game.players.find(p => p.name === gameState.username);
            const isCzar = gameState.game.players[gameState.game.currentCzarIndex].name === gameState.username;
            
            if (isCzar) {
                // Show waiting message for Czar
                elements.playerHandArea.classList.add('hidden');
                elements.czarSelectionArea.classList.remove('hidden');
                
                // Show submitted cards for Czar to pick
                updateSubmittedCards();
            } else {
                // Show player's hand
                elements.playerHandArea.classList.remove('hidden');
                elements.czarSelectionArea.classList.add('hidden');
                
                // Clear current hand
                elements.playerHand.innerHTML = '';
                
                // Add cards to hand
                currentPlayer.hand.forEach((card, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card p-4 cursor-pointer hover:bg-gray-800 transition';
                    if (gameState.selectedCards.includes(index)) {
                        cardElement.classList.add('card-selected');
                    }
                    cardElement.innerHTML = `<p>${card}</p>`;
                    
                    cardElement.addEventListener('click', () => toggleCardSelection(index));
                    
                    elements.playerHand.appendChild(cardElement);
                });
                
                // Update cards remaining display
                elements.cardsRemainingDisplay.textContent = `${currentPlayer.hand.length} cards remaining`;
                
                // Show appropriate message based on selection status
                if (gameState.selectedCards.length > 0) {
                    elements.waitingForCzarMessage.classList.add('hidden');
                    elements.selectCardsMessage.classList.remove('hidden');
                    
                    const remaining = gameState.game.blackCard.pick - gameState.selectedCards.length;
                    elements.cardsToSelectDisplay.textContent = remaining > 0 ? 
                        `Select ${remaining} more card${remaining > 1 ? 's' : ''}` : 
                        'Ready to submit!';
                } else {
                    elements.waitingForCzarMessage.classList.add('hidden');
                    elements.selectCardsMessage.classList.add('hidden');
                }
            }
        }
        
        function toggleCardSelection(index) {
            const currentPlayer = gameState.game.players.find(p => p.name === gameState.username);
            const cardElement = elements.playerHand.children[index];
            
            // Check if card is already selected
            const selectedIndex = gameState.selectedCards.indexOf(index);
            
            if (selectedIndex !== -1) {
                // Deselect card
                gameState.selectedCards.splice(selectedIndex, 1);
                cardElement.classList.remove('card-selected');
            } else {
                // Check if we can select more cards
                if (gameState.selectedCards.length >= gameState.game.blackCard.pick) {
                    alert(`You can only select ${gameState.game.blackCard.pick} cards for this round`);
                    return;
                }
                
                // Select card
                gameState.selectedCards.push(index);
                cardElement.classList.add('card-selected');
            }
            
            // Update UI
            updateGameScreen();
        }
        
        function submitCards() {
            if (!gameState.game || gameState.selectedCards.length !== gameState.game.blackCard.pick) return;
            
            const currentPlayer = gameState.game.players.find(p => p.name === gameState.username);
            
            // Create submission
            const submission = {
                playerId: currentPlayer.id,
                playerName: currentPlayer.name,
                cards: gameState.selectedCards.map(index => currentPlayer.hand[index]),
                picked: false
            };
            
            // Add to submitted cards
            gameState.game.submittedCards.push(submission);
            
            // Remove selected cards from hand
            gameState.selectedCards.sort((a, b) => b - a); // Sort descending for proper removal
            gameState.selectedCards.forEach(index => {
                currentPlayer.hand.splice(index, 1);
            });
            
            // Clear selection
            gameState.selectedCards = [];
            
            // Add new card to hand if needed
            if (currentPlayer.hand.length < 3) {
                currentPlayer.hand.push(getRandomWhiteCard());
            }
            
            // Update UI
            updateGameScreen();
            
            // Add system message
            addGameChatMessage('System', `${gameState.username} has submitted their answer`, true);
            
            // Check if all players have submitted (except Czar)
            const playersWhoCanSubmit = gameState.game.players.filter((_, index) => index !== gameState.game.currentCzarIndex);
            const allSubmitted = playersWhoCanSubmit.every(player => {
                return gameState.game.submittedCards.some(sub => sub.playerId === player.id);
            });
            
            if (allSubmitted) {
                // Notify Czar to pick a winner
                const czarName = gameState.game.players[gameState.game.currentCzarIndex].name;
                addGameChatMessage('System', `All answers are in! ${czarName}, choose the winning answer.`, true);
            }
        }
        
        function updateSubmittedCards() {
            elements.submittedCardsContainer.innerHTML = '';
            
            gameState.game.submittedCards.forEach((submission, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card p-4 cursor-pointer hover:bg-gray-800 transition';
                cardElement.innerHTML = `
                    <p class="mb-2">${submission.cards.join(' ')}</p>
                    <p class="text-sm text-gray-400">Submitted by ${submission.playerName}</p>
                `;
                
                cardElement.addEventListener('click', () => pickWinner(index));
                
                elements.submittedCardsContainer.appendChild(cardElement);
            });
        }
        
        function pickWinner(submissionIndex) {
            if (!gameState.game) return;
            
            const czar = gameState.game.players[gameState.game.currentCzarIndex];
            if (czar.name !== gameState.username) return;
            
            const winningSubmission = gameState.game.submittedCards[submissionIndex];
            
            // Award point to winner
            const winningPlayer = gameState.game.players.find(p => p.id === winningSubmission.playerId);
            if (winningPlayer) {
                winningPlayer.points += 1;
            }
            
            // Add system message
            addGameChatMessage('System', `${czar.name} has chosen "${winningSubmission.cards.join(' ')}" by ${winningPlayer.name} as the winning answer!`, true);
            
            // Check if game is over
            if (gameState.game.round >= gameState.game.totalRounds) {
                endGame();
                return;
            }
            
            // Move to next round
            nextRound();
        }
        
        function nextRound() {
            if (!gameState.game) return;
            
            // Increment round
            gameState.game.round += 1;
            
            // Move Czar to next player
            gameState.game.currentCzarIndex = (gameState.game.currentCzarIndex + 1) % gameState.game.players.length;
            
            // Get new black card
            gameState.game.blackCard = getRandomBlackCard();
            
            // Clear submitted cards
            gameState.game.submittedCards = [];
            
            // Update UI
            updateGameScreen();
            
            // Add system message
            const newCzar = gameState.game.players[gameState.game.currentCzarIndex];
            addGameChatMessage('System', `Round ${gameState.game.round} begins! ${newCzar.name} is the new Card Czar.`, true);
        }
        
        function endGame() {
            if (!gameState.game) return;
            
            // Sort players by points (descending)
            const sortedPlayers = [...gameState.game.players].sort((a, b) => b.points - a.points);
            
            // Update final scores display
            elements.finalScores.innerHTML = '';
            
            sortedPlayers.forEach((player, index) => {
                const playerElement = document.createElement('div');
                playerElement.className = 'flex justify-between items-center p-3 bg-gray-800 rounded-lg';
                playerElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full ${index === 0 ? 'bg-red-900' : 'bg-gray-700'} flex items-center justify-center mr-3">
                            <i class="fas ${index === 0 ? 'fa-crown' : 'fa-user'} text-xs"></i>
                        </div>
                        <span class="font-medium">${player.name}</span>
                    </div>
                    <span class="font-bold ${index === 0 ? 'text-red-500' : 'text-gray-300'}">${player.points} point${player.points !== 1 ? 's' : ''}</span>
                `;
                
                elements.finalScores.appendChild(playerElement);
            });
            
            // Show game over modal
            showScreen('gameOverModal');
        }
        
        function newGame() {
            if (!gameState.lobby) return;
            
            // Start a new game with same lobby settings
            startGame();
        }
        
        function returnToLobby() {
            if (!gameState.lobby) return;
            
            // Return to lobby screen
            updateLobbyScreen();
            showScreen('lobbyScreen');
        }
        
        function returnToMainMenu() {
            // Reset game state
            gameState.lobby = null;
            gameState.game = null;
            gameState.isHost = false;
            gameState.selectedCards = [];
            gameState.submittedCards = [];
            
            // Return to main menu
            showScreen('mainMenu');
        }
        
        function leaveGame() {
            if (confirm('Are you sure you want to leave the game? Your progress will be lost.')) {
                // In a real app, this would notify the server
                
                // Add system message
                addGameChatMessage('System', `${gameState.username} has left the game`, true);
                
                // Return to main menu
                returnToMainMenu();
            }
        }
        
        function sendLobbyChat() {
            const message = elements.chatInput.value.trim();
            if (message.length === 0) return;
            
            // Add message to chat
            addChatMessage(gameState.username, message);
            
            // Clear input
            elements.chatInput.value = '';
        }
        
        function sendGameChat() {
            const message = elements.gameChatInput.value.trim();
            if (message.length === 0) return;
            
            // Add message to chat
            addGameChatMessage(gameState.username, message);
            
            // Clear input
            elements.gameChatInput.value = '';
        }
        
        function addChatMessage(sender, message, isSystem = false) {
            if (!gameState.lobby) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = isSystem ? 'text-gray-400 italic' : '';
            messageElement.innerHTML = `
                <span class="${isSystem ? '' : 'font-bold text-red-400'}">${sender}:</span> ${message}
            `;
            
            elements.chatMessages.appendChild(messageElement);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
            
            // Add to lobby chat history
            gameState.lobby.chat.push({
                sender,
                message,
                isSystem,
                timestamp: new Date()
            });
        }
        
        function addGameChatMessage(sender, message, isSystem = false) {
            if (!gameState.game) return;
            
            const messageElement = document.createElement('div');
            messageElement.className = isSystem ? 'text-gray-400 italic' : '';
            messageElement.innerHTML = `
                <span class="${isSystem ? '' : 'font-bold text-red-400'}">${sender}:</span> ${message}
            `;
            
            elements.gameChatMessages.appendChild(messageElement);
            elements.gameChatMessages.scrollTop = elements.gameChatMessages.scrollHeight;
            
            // Add to game chat history
            gameState.game.chat.push({
                sender,
                message,
                isSystem,
                timestamp: new Date()
            });
        }
        
        function getRandomWhiteCard() {
            if (gameState.whiteCards.length === 0) {
                return "A mysterious blank card";
            }
            return gameState.whiteCards[Math.floor(Math.random() * gameState.whiteCards.length)];
        }
        
        function getRandomBlackCard() {
            if (gameState.blackCards.length === 0) {
                return { text: "Why did the chicken cross the road? _____.", pick: 1 };
            }
            return gameState.blackCards[Math.floor(Math.random() * gameState.blackCards.length)];
        }
        
        function showScreen(screenName) {
            // Hide all screens first
            document.querySelectorAll('#mainMenu, #lobbyScreen, #gameScreen, .modal-overlay').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show the requested screen
            if (screenName === 'mainMenu') {
                elements.mainMenu.classList.remove('hidden');
            } else if (screenName === 'lobbyScreen') {
                elements.lobbyScreen.classList.remove('hidden');
            } else if (screenName === 'gameScreen') {
                elements.gameScreen.classList.remove('hidden');
            } else if (screenName === 'gameOverModal') {
                elements.gameOverModal.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>